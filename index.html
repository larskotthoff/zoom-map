<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Mercator projection</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.9/d3.min.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,900,700italic' rel='stylesheet'
        type='text/css'>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
        integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ=="
        crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"
        integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"
          integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ=="
          crossorigin="anonymous"></script>
  <style type="text/css">


    body {
      /*background-color: lightgoldenrodyellow;*/
    }

    svg {
      background-color: white;
    }

    h1, p {
      font-family: Lato, Helvetica, Arial, "Lucida Grande", sans-serif;
    }

    h1 {
      font-weight: 700;
    }
    p {
      font-size:18px;
    }
    .circle {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display:inline-block;
    }

  </style>
</head>
<body>
<div class="container">
  <div class="row">
    <h1>Ex-Offender Voting Rights<br/>Maryland 2015 Vote on HB 980 </h1>

    <p>Maryland Governor Hogan vetoed HB 980, which would have restored voting rights to ex-felons who are still under parole or probation. The bill passed the House of Delegates with 82 votes &mdash; short by three votes of a 60% majority needed to override the veto. This map shows how each Delegate voted.</p>
    <p><div class="circle" style="background:#FF7F0E"></div>&nbsp;Yea&nbsp;&nbsp;&nbsp;
    <div class="circle" style="background:#1f77b4"></div>&nbsp;Nay&nbsp;&nbsp;&nbsp;
    <div class="circle" style="background:#d62728"></div>&nbsp;Not Voting&nbsp;&nbsp;&nbsp;
    <div class="circle" style="background:#2CA02C"></div>&nbsp;Absent&nbsp;&nbsp;&nbsp;
    </p>
  </div>
</div>
<script type="text/javascript">

  //Width and height
  var w = 800;
  var h = 620;

  var tooltip = d3.select("body")
      .append("div")
      .style("position", "absolute")
      .style("z-index", "10")
      .style("visibility", "hidden")
      .style("text-shadow", "white 2px 2px")
      .style("opacity", "0.87")
      .style("background-color", "#F8F8F8")
      .style("line-height","1.1")

  //Define map projection
  var projection = d3.geo.mercator()
      .center([0, 38.4])
      .translate([ w / 2, h / 2 ])
      .scale([w * 11.5])
      .rotate([77.56, 0]);

  //Define path generator
  var path = d3.geo.path()
      .projection(projection);

  //Create SVG
  var svg = d3.select(".row")
      .append("svg")
      .attr("width", w)
      .attr("height", h);

  var colors = d3.scale.category10();

  d3.csv("HB980-vote-2014.csv", function (data) {

    //Create a circle for each city
    svg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("cx", function (d) {
          //[0] returns the first coordinate (x) of the projected value
          return projection([d.longitude, d.latitude])[0];
        })
        .attr("cy", function (d) {
          //[1] returns the second coordinate (y) of the projected value
          return projection([d.longitude, d.latitude])[1];
        })
        .attr("r", 3.4)
        .on("mouseover", function(){
          return tooltip.style("visibility", "visible");
        })
        .on("mousemove", function(d,i){

          var ttip = "<strong>"
                  + d.full_name
                  + "</strong>"
                  + " ("
                  + d.party.charAt(0)
                  + ")<br />District "
                  + d.indexmatch
                  + "<br />" + d.hb0980;
          return tooltip
              .style("top", (d3.event.pageY-10)+"px")
              .style("left",(d3.event.pageX+10)+"px")
              .html(ttip)
        })
        .on("mouseout", function(){
          return tooltip.style("visibility", "hidden");
        })
        .style("fill", "yellow")
        .style("opacity", 0.84)
        .style("fill", function (d) {

          //Get data value
          var value = d.hb0980;

          if (value) {
            //If value exists…
            return colors(value);
          } else {
            //If value is undefined…
            return "#bcbcbc";
          }

        })

  });
  //Load in GeoJSON data
  //  d3.json("../data/countries/mapshaper_output.json", function(json) {
  d3.json("maryland.json", function (json) {
    //Bind data and create one path per GeoJSON feature
    svg.selectAll("path")
        .data(json.geometry)
        .enter()
        .append("path")
        .attr("d", path)
        .attr("fill", "none")
        .attr("stroke", "#bbb")

  });


</script>
</body>
</html>
